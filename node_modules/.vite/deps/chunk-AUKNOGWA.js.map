{
  "version": 3,
  "sources": ["../../valtio/esm/react.mjs"],
  "sourcesContent": ["import { useMemo, useRef, useSyncExternalStore, useCallback, useLayoutEffect, useEffect, useDebugValue } from 'react';\nimport { isChanged, createProxy, affectedToPathList } from 'proxy-compare';\nimport { subscribe, snapshot } from 'valtio/vanilla';\n\nconst useAffectedDebugValue = (state, affected) => {\n  const pathList = useRef(void 0);\n  useEffect(() => {\n    pathList.current = affectedToPathList(state, affected, true);\n  });\n  useDebugValue(pathList.current);\n};\nconst condUseAffectedDebugValue = useAffectedDebugValue;\nconst targetCache = /* @__PURE__ */ new WeakMap();\nfunction useSnapshot(proxyObject, options) {\n  const notifyInSync = options == null ? void 0 : options.sync;\n  const affected = useMemo(\n    () => proxyObject && /* @__PURE__ */ new WeakMap(),\n    [proxyObject]\n  );\n  const lastSnapshot = useRef(void 0);\n  let inRender = true;\n  const currSnapshot = useSyncExternalStore(\n    useCallback(\n      (callback) => {\n        const unsub = subscribe(proxyObject, callback, notifyInSync);\n        callback();\n        return unsub;\n      },\n      [proxyObject, notifyInSync]\n    ),\n    () => {\n      const nextSnapshot = snapshot(proxyObject);\n      try {\n        if (!inRender && lastSnapshot.current && !isChanged(\n          lastSnapshot.current,\n          nextSnapshot,\n          affected,\n          /* @__PURE__ */ new WeakMap()\n        )) {\n          return lastSnapshot.current;\n        }\n      } catch (e) {\n      }\n      return nextSnapshot;\n    },\n    () => snapshot(proxyObject)\n  );\n  inRender = false;\n  useLayoutEffect(() => {\n    lastSnapshot.current = currSnapshot;\n  });\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n    condUseAffectedDebugValue(currSnapshot, affected);\n  }\n  const proxyCache = useMemo(() => /* @__PURE__ */ new WeakMap(), []);\n  return createProxy(currSnapshot, affected, proxyCache, targetCache);\n}\n\nexport { useSnapshot };\n"],
  "mappings": ";;;;;;;;;;;;;;;AAAA,mBAA8G;AAI9G,IAAM,wBAAwB,CAAC,OAAO,aAAa;AACjD,QAAM,eAAW,qBAAO,MAAM;AAC9B,8BAAU,MAAM;AACd,aAAS,UAAU,mBAAmB,OAAO,UAAU,IAAI;AAAA,EAC7D,CAAC;AACD,kCAAc,SAAS,OAAO;AAChC;AACA,IAAM,4BAA4B;AAClC,IAAM,cAA8B,oBAAI,QAAQ;AAChD,SAAS,YAAY,aAAa,SAAS;AACzC,QAAM,eAAe,WAAW,OAAO,SAAS,QAAQ;AACxD,QAAM,eAAW;AAAA,IACf,MAAM,eAA+B,oBAAI,QAAQ;AAAA,IACjD,CAAC,WAAW;AAAA,EACd;AACA,QAAM,mBAAe,qBAAO,MAAM;AAClC,MAAI,WAAW;AACf,QAAM,mBAAe;AAAA,QACnB;AAAA,MACE,CAAC,aAAa;AACZ,cAAM,QAAQ,UAAU,aAAa,UAAU,YAAY;AAC3D,iBAAS;AACT,eAAO;AAAA,MACT;AAAA,MACA,CAAC,aAAa,YAAY;AAAA,IAC5B;AAAA,IACA,MAAM;AACJ,YAAM,eAAe,SAAS,WAAW;AACzC,UAAI;AACF,YAAI,CAAC,YAAY,aAAa,WAAW,CAAC;AAAA,UACxC,aAAa;AAAA,UACb;AAAA,UACA;AAAA,UACgB,oBAAI,QAAQ;AAAA,QAC9B,GAAG;AACD,iBAAO,aAAa;AAAA,QACtB;AAAA,MACF,SAAS,GAAG;AAAA,MACZ;AACA,aAAO;AAAA,IACT;AAAA,IACA,MAAM,SAAS,WAAW;AAAA,EAC5B;AACA,aAAW;AACX,oCAAgB,MAAM;AACpB,iBAAa,UAAU;AAAA,EACzB,CAAC;AACD,OAAK,YAAY,MAAM,YAAY,IAAI,OAAO,YAAY,cAAc;AACtE,8BAA0B,cAAc,QAAQ;AAAA,EAClD;AACA,QAAM,iBAAa,sBAAQ,MAAsB,oBAAI,QAAQ,GAAG,CAAC,CAAC;AAClE,SAAO,YAAY,cAAc,UAAU,YAAY,WAAW;AACpE;",
  "names": []
}
